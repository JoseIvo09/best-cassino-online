<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gratis Bet Seu Cassino Online - Cadastro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="CSS/style.css"/>
  <style>
    /* Adicione este CSS se n√£o estiver em style.css para os requisitos de senha */
    .valid { color: green; }
    .invalid { color: red; }
    .password-container { position: relative; }
    .toggle-password {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      user-select: none; /* Para evitar sele√ß√£o de texto no √≠cone */
    }
  </style>
</head>
<body>

  <header>
    <img src="img/placeholder_banner.jpg" alt="Banner do Cassino" style="max-width: 100%; height: auto; margin-top: 5px;">
    <nav>
      <a href="index.html">In√≠cio</a>
      <a href="jogos.html">Jogos</a>
      <a href="login.html">Login</a>
      <a href="cadastro.html">Cadastro</a> </nav>
  </header>

  <main>
    <section class="hero">
      <h2>Bem-vindo ao Gratis Bet - Seu Cassino Online!</h2>
      <p>Experimente a emo√ß√£o e divers√£o dos slots totalmente gratuitos.</p>
    </section>

    <div class="cadastro-container">
      <div class="cadastro-box">
        <h2>Cadastro</h2>

        <form onsubmit="event.preventDefault(); window.redirecionar();" aria-label="Formul√°rio de cadastro com e-mail">
          <div class="form-group">
            <label for="nome">Nome Completo:</label>
            <input type="text" id="nome" name="nome" required>
          </div>

          <div class="form-group">
            <label for="username">Nome de Usu√°rio:</label>
            <input type="text" id="username" name="username" required>
          </div>

          <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
          </div>

          <div class="form-group">
            <label for="senha">Senha:</label>
            <div class="password-container">
              <input type="password" id="senha" name="senha" required>
              <span class="toggle-password" onclick="window.toggleSenha('senha')">üëÅÔ∏è</span>
            </div>
          </div>

          <div class="form-group">
            <label for="senhaConfirmacao">Repita a Senha:</label>
            <div class="password-container">
              <input type="password" id="senhaConfirmacao" name="senhaConfirmacao" required>
              <span class="toggle-password" onclick="window.toggleSenha('senhaConfirmacao')">üëÅÔ∏è</span>
            </div>
          </div>

          <div id="mensagemSenha"></div>

          <h3>Requisitos da Senha:</h3>
          <ul>
            <li id="requisitoMinLength">M√≠nimo de 8 caracteres</li>
            <li id="requisitoUpperCase">Pelo menos uma letra mai√∫scula (A-Z)</li>
            <li id="requisitoLowerCase">Pelo menos uma letra min√∫scula (a-z)</li>
            <li id="requisitoNumber">Pelo menos um n√∫mero (0-9)</li>
            <li id="requisitoSpecialChar">Pelo menos um caractere especial (!@#$%^&*)</li>
          </ul>

          <button type="submit" class="btn-cadastrar">Cadastrar com Email</button>
        </form>

        <hr>

        <h3>Ou cadastre-se com n√∫mero de celular</h3>
        <div class="form-group">
          <label for="country-code">C√≥digo do Pa√≠s:</label>
          <select id="country-code" name="codigo_pais" required>
              <option value="+55" selected>Brasil (+55)</option>
              <option value="+1">Estados Unidos (+1)</option>
              <option value="+54">Argentina (+54)</option>
             <option value="+93">Afeganist√£o (+93)</option>
              <option value="+27">√Åfrica do Sul (+27)</option>
              <option value="+213">Arg√©lia (+213)</option>
              <option value="+244">Angola (+244)</option>
              <option value="+966">Ar√°bia Saudita (+966)</option>
              <option value="+61">Austr√°lia (+61)</option>
              <option value="+43">√Åustria (+43)</option>
              <option value="+880">Bangladesh (+880)</option>
              <option value="+32">B√©lgica (+32)</option>
              <option value="+501">Belize (+501)</option>
              <option value="+229">Benin (+229)</option>
              <option value="+591">Bol√≠via (+591)</option>
              <option value="+359">Bulg√°ria (+359)</option>
              <option value="+237">Camar√µes (+237)</option>
              <option value="+1">Canad√° (+1)</option>
              <option value="+236">Rep√∫blica Centro-Africana (+236)</option>
              <option value="+56">Chile (+56)</option>
              <option value="+86">China (+86)</option>
              <option value="+57">Col√¥mbia (+57)</option>
              <option value="+506">Costa Rica (+506)</option>
              <option value="+225">Costa do Marfim (+225)</option>
              <option value="+385">Cro√°cia (+385)</option>
              <option value="+503">El Salvador (+503)</option>
              <option value="+971">Emirados √Årabes Unidos (+971)</option>
              <option value="+593">Equador (+593)</option>
              <option value="+372">Est√¥nia (+372)</option>
              <option value="+251">Eti√≥pia (+251)</option>
              <option value="+63">Filipinas (+63)</option>
              <option value="+358">Finl√¢ndia (+358)</option>
              <option value="+33">Fran√ßa (+33)</option>
              <option value="+49">Alemanha (+49)</option>
              <option value="+30">Gr√©cia (+30)</option>
              <option value="+502">Guatemala (+502)</option>
              <option value="+240">Guin√© Equatorial (+240)</option>
              <option value="+91">√çndia (+91)</option>
              <option value="+62">Indon√©sia (+62)</option>
              <option value="+972">Israel (+972)</option>
              <option value="+39">It√°lia (+39)</option>
              <option value="+81">Jap√£o (+81)</option>
              <option value="+254">Qu√™nia (+254)</option>
              <option value="+266">Lesoto (+266)</option>
              <option value="+218">L√≠bia (+218)</option>
              <option value="+223">Mali (+223)</option>
              <option value="+60">Mal√°sia (+60)</option>
              <option value="+212">Marrocos (+212)</option>
              <option value="+52">M√©xico (+52)</option>
              <option value="+258">Mo√ßambique (+258)</option>
              <option value="+234">Nig√©ria (+234)</option>
              <option value="+505">Nicar√°gua (+505)</option>
              <option value="+31">Pa√≠ses Baixos (Holanda) (+31)</option>
              <option value="+507">Panam√° (+507)</option>
              <option value="+92">Paquist√£o (+92)</option>
              <option value="+595">Paraguai (+595)</option>
              <option value="+51">Peru (+51)</option>
              <option value="+48">Pol√¥nia (+48)</option>
              <option value="+351">Portugal (+351)</option>
              <option value="+40">Rom√™nia (+40)</option>
              <option value="+7">R√∫ssia (+7)</option>
              <option value="+65">Singapura (+65)</option>
              <option value="+82">Coreia do Sul (+82)</option>
              <option value="+34">Espanha (+34)</option>
              <option value="+46">Su√©cia (+46)</option>
              <option value="+41">Su√≠√ßa (+41)</option>
              <option value="+249">Sud√£o (+249)</option>
              <option value="+66">Tail√¢ndia (+66)</option>
              <option value="+255">Tanz√¢nia (+255)</option>
              <option value="+216">Tun√≠sia (+216)</option>
              <option value="+90">Turquia (+90)</option>
              <option value="+256">Uganda (+256)</option>
              <option value="+598">Uruguai (+598)</option>
              <option value="+998">Uzbequist√£o (+998)</option>
              <option value="+58">Venezuela (+58)</option>
              <option value="+260">Z√¢mbia (+260)</option>
              </select>
        </div>

        <div class="form-group">
          <label for="phoneNumber">N√∫mero de Celular (com DDD):</label>
          <input type="tel" id="phoneNumber" name="telefone" placeholder="XX XXXXX-XXXX" pattern="\d{2}\s?\d{5}-?\d{4}" required>
        </div>

        <div id="recaptcha-container"></div>

        <div class="form-group">
          <button type="button" onclick="window.enviarCodigo()">Enviar C√≥digo via SMS</button>
        </div>

        <div class="form-group">
          <label for="smsCode">C√≥digo de Verifica√ß√£o:</label>
          <input type="text" id="smsCode" placeholder="C√≥digo recebido via SMS" inputmode="numeric" autocomplete="one-time-code">
        </div>

        <div class="form-group">
          <button type="button" onclick="window.verificarCodigo()">Verificar e Cadastrar</button>
        </div>

        <hr>

        <div class="google-btn" onclick="window.loginComGoogle()">
          <div class="google-icon-wrapper">
            <img class="google-icon" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo">
          </div>
          <span class="btn-text">Continuar com o Google</span>
        </div>

        <div class="login-link">
          J√° tem uma conta? <a href="login.html">Fa√ßa login aqui</a>
        </div>

        <div class="recover-password-link">
          <a href="#" onclick="window.recuperarSenha()">Esqueceu a senha?</a>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 Gratis Bet. Desenvolvido por Sinnomar Silva Lino. Todos os direitos reservados.</p>
  </footer>

  <script type="module">
    // Importa√ß√µes do Firebase SDK (Modular v9+)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      GoogleAuthProvider,
      signInWithPopup,
      sendPasswordResetEmail,
      RecaptchaVerifier,
      signInWithPhoneNumber,
      getRedirectResult
    } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-auth.js";

    // Configura√ß√£o do Firebase (mantenha suas chaves aqui)
    const firebaseConfig = {
      apiKey: "AIzaSyAvDHmSCgDLnGVk5-8wF5gy3VE7ZlojcKY", // SUBSTITUA PELA SUA API KEY REAL E PROTEJA-A COM REGRAS DE SEGURAN√áA
      authDomain: "freebet-9b925.firebaseapp.com",
      projectId: "freebet-9b925",
      storageBucket: "freebet-9b925.appspot.com", // Corrigido para .appspot.com se for o padr√£o
      messagingSenderId: "626232438021",
      appId: "1:626232438021:web:aba78987dd6ecce213db6c"
    };

    // Inicializa o Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Tratamento de redirecionamento do login (ex: Google Sign-In com redirect)
    getRedirectResult(auth)
      .then((result) => {
        if (result && result.user) {
          // Usu√°rio logado via redirecionamento
          alert(`Bem-vindo de volta, ${result.user.displayName}!`);
          window.location.href = "lobby.html"; // Redireciona para a p√°gina de lobby/principal
        }
      })
      .catch((error) => {
        console.error("Erro ao obter resultado de redirecionamento:", error);
        // Evite alertar em cada carregamento de p√°gina se n√£o houver um resultado de redirecionamento.
        // Alertar apenas para erros reais.
        if (error.code) {
             alert("Erro ap√≥s redirecionamento: " + error.message);
        }
      });

    // --- Fun√ß√µes JS ---

    window.toggleSenha = function(id) {
      const input = document.getElementById(id);
      const icon = input.nextElementSibling; // Assume que o √≠cone √© o pr√≥ximo irm√£o

      if (input.type === "password") {
        input.type = "text";
        icon.textContent = "üôà";
      } else {
        input.type = "password";
        icon.textContent = "üëÅÔ∏è";
      }
    }

    window.redirecionar = function() {
      const nome = document.getElementById("nome").value.trim();
      const username = document.getElementById("username").value.trim();
      const email = document.getElementById("email").value.trim();
      const senha = document.getElementById("senha").value;
      const senhaConfirmacao = document.getElementById("senhaConfirmacao").value;
      const mensagem = document.getElementById("mensagemSenha");

      if (!nome || !username || !email || !senha || !senhaConfirmacao) {
        mensagem.textContent = "Por favor, preencha todos os campos obrigat√≥rios do cadastro com email.";
        mensagem.style.color = "red";
        return;
      }

      if (senha !== senhaConfirmacao) {
        mensagem.textContent = "As senhas n√£o coincidem.";
        mensagem.style.color = "red";
        return;
      }

      // Verificar requisitos da senha antes de tentar o cadastro
      const { minLength, upperCase, lowerCase, number, specialChar } = verificarRequisitosSenha(senha);
      if (!minLength || !upperCase || !lowerCase || !number || !specialChar) {
        mensagem.textContent = "A senha n√£o atende a todos os requisitos.";
        mensagem.style.color = "red";
        // Atualizar visualmente os requisitos
        atualizarFeedbackRequisitosSenha(senha);
        return;
      }


      createUserWithEmailAndPassword(auth, email, senha)
        .then((userCredential) => {
          // Cadastro bem-sucedido
          const user = userCredential.user;
          console.log("Usu√°rio cadastrado:", user);
          mensagem.textContent = "Cadastro realizado com sucesso! Redirecionando para login...";
          mensagem.style.color = "green";
          // Voc√™ pode querer atualizar o perfil do usu√°rio com o nome aqui, se necess√°rio
          // updateProfile(user, { displayName: nome }).then(...);
          setTimeout(() => window.location.href = "login.html", 2000);
        })
        .catch((error) => {
          console.error("Erro no cadastro:", error);
          if (error.code === 'auth/email-already-in-use') {
            mensagem.textContent = "Este email j√° est√° em uso. Tente outro ou fa√ßa login.";
          } else if (error.code === 'auth/weak-password') {
            mensagem.textContent = "A senha √© muito fraca. Por favor, escolha uma senha mais forte.";
          } else {
            mensagem.textContent = "Erro ao cadastrar: " + error.message;
          }
          mensagem.style.color = "red";
        });
    }

    // Fun√ß√£o auxiliar para verificar os requisitos da senha (retorna um objeto com booleanos)
    function verificarRequisitosSenha(senha) {
        return {
            minLength: senha.length >= 8,
            upperCase: /[A-Z]/.test(senha),
            lowerCase: /[a-z]/.test(senha),
            number: /[0-9]/.test(senha),
            specialChar: /[!@#$%^&*(),.?":{}|<>]/.test(senha) // Ajuste os caracteres especiais conforme sua pol√≠tica
        };
    }

    // Fun√ß√£o para atualizar o feedback visual dos requisitos da senha
    function atualizarFeedbackRequisitosSenha(senha) {
        const requisitos = verificarRequisitosSenha(senha);
        document.getElementById("requisitoMinLength").className = requisitos.minLength ? "valid" : "invalid";
        document.getElementById("requisitoUpperCase").className = requisitos.upperCase ? "valid" : "invalid";
        document.getElementById("requisitoLowerCase").className = requisitos.lowerCase ? "valid" : "invalid";
        document.getElementById("requisitoNumber").className = requisitos.number ? "valid" : "invalid";
        document.getElementById("requisitoSpecialChar").className = requisitos.specialChar ? "valid" : "invalid";
    }


    window.verificarSenhaNoInput = function() { // Renomeado para evitar conflito e ser mais espec√≠fico
      const senha = document.getElementById("senha").value;
      atualizarFeedbackRequisitosSenha(senha);
    }

    window.verificarConfirmacaoSenha = function() {
      const senha = document.getElementById("senha").value;
      const senhaConfirmacao = document.getElementById("senhaConfirmacao").value;
      const mensagem = document.getElementById("mensagemSenha");

      if (senhaConfirmacao) { // Apenas mostra mensagem se o campo de confirma√ß√£o tiver algo
        if (senha === senhaConfirmacao) {
          mensagem.textContent = "As senhas coincidem.";
          mensagem.style.color = "green";
        } else {
          mensagem.textContent = "As senhas n√£o coincidem.";
          mensagem.style.color = "red";
        }
      } else {
        mensagem.textContent = ""; // Limpa a mensagem se a confirma√ß√£o estiver vazia
      }
    }

    window.loginComGoogle = function() {
      const provider = new GoogleAuthProvider();
      signInWithPopup(auth, provider)
        .then((result) => {
          // Login com Google bem-sucedido
          const user = result.user;
          console.log("Usu√°rio logado com Google:", user);
          alert(`Bem-vindo, ${user.displayName}!`);
          window.location.href = "lobby.html"; // Redireciona para a p√°gina de lobby/principal
        })
        .catch((error) => {
          console.error("Erro ao fazer login com Google:", error);
          alert("Erro ao fazer login com Google: " + error.message);
        });
    }

    window.recuperarSenha = function() {
      const email = prompt("Por favor, insira seu e-mail para redefinir a senha:");
      if (email) {
        sendPasswordResetEmail(auth, email)
          .then(() => {
            alert("E-mail de recupera√ß√£o enviado. Verifique sua caixa de entrada e pasta de spam.");
          })
          .catch((error) => {
            console.error("Erro ao enviar e-mail de recupera√ß√£o:", error);
            alert("Erro ao enviar e-mail de recupera√ß√£o: " + error.message);
          });
      }
    }

    // Autentica√ß√£o por telefone
    // O RecaptchaVerifier deve ser renderizado antes de signInWithPhoneNumber ser chamado.
    // Se for invis√≠vel, ele se anexa a um bot√£o ou √© acionado programaticamente.
    // Garanta que 'recaptcha-container' esteja vis√≠vel ou que o reCAPTCHA invis√≠vel funcione como esperado.
    window.recaptchaVerifierInstance = null; // Para armazenar a inst√¢ncia do reCAPTCHA

    function inicializarRecaptcha() {
        // Limpa qualquer reCAPTCHA anterior para evitar erros de 'reCAPTCHA container is already rendered'.
        const recaptchaContainer = document.getElementById('recaptcha-container');
        if (recaptchaContainer) {
            recaptchaContainer.innerHTML = '';
        }

        if (!window.recaptchaVerifierInstance) { // Inicializa apenas uma vez ou se necess√°rio
            window.recaptchaVerifierInstance = new RecaptchaVerifier(auth, 'recaptcha-container', {
                'size': 'invisible', // Pode ser 'normal' se voc√™ quiser que o usu√°rio o veja
                'callback': (response) => {
                    // reCAPTCHA resolvido. Chamado automaticamente para reCAPTCHA vis√≠vel
                    // Para invis√≠vel, signInWithPhoneNumber pode ser chamado aqui se o fluxo exigir
                    console.log("reCAPTCHA resolvido:", response);
                },
                'expired-callback': () => {
                    // Resposta expirou. Pe√ßa ao usu√°rio para resolver o reCAPTCHA novamente.
                    alert("Verifica√ß√£o reCAPTCHA expirou. Por favor, tente enviar o c√≥digo novamente.");
                    if (window.recaptchaVerifierInstance) {
                         window.recaptchaVerifierInstance.render().then(function(widgetId) {
                            grecaptcha.reset(widgetId); // grecaptcha pode n√£o estar diretamente dispon√≠vel, use auth.RecaptchaVerifier.prototype.clear se dispon√≠vel
                         });
                    }
                }
            });
            return window.recaptchaVerifierInstance.render(); // Renderiza o reCAPTCHA invis√≠vel
        }
        return Promise.resolve(window.recaptchaVerifierInstance);

    }


    window.confirmationResult = null; // Para armazenar o resultado da confirma√ß√£o do SMS

    window.enviarCodigo = async function() {
      const countryCode = document.getElementById("country-code").value;
      const phoneNumberInput = document.getElementById("phoneNumber").value;
      const mensagem = document.getElementById("mensagemSenha"); // Usar para feedback de telefone tamb√©m

      if (!phoneNumberInput) {
        alert("Por favor, digite um n√∫mero de telefone v√°lido.");
        return;
      }
      // Remove caracteres n√£o num√©ricos do telefone para formar o n√∫mero E.164
      const justDigitsPhoneNumber = phoneNumberInput.replace(/\D/g, '');
      const fullPhoneNumber = countryCode + justDigitsPhoneNumber;

      console.log("Tentando enviar c√≥digo para:", fullPhoneNumber);

      try {
        await inicializarRecaptcha(); // Garante que o reCAPTCHA est√° pronto
        const appVerifier = window.recaptchaVerifierInstance;

        signInWithPhoneNumber(auth, fullPhoneNumber, appVerifier)
          .then((confirmationResultPayload) => {
            window.confirmationResult = confirmationResultPayload;
            alert("C√≥digo SMS enviado com sucesso para " + fullPhoneNumber + "! Verifique seu celular.");
            mensagem.textContent = "C√≥digo SMS enviado!";
            mensagem.style.color = "blue";
          })
          .catch((error) => {
            console.error("Erro ao enviar c√≥digo SMS:", error);
            mensagem.textContent = "Erro ao enviar c√≥digo SMS: " + error.message;
            if (error.code === 'auth/invalid-phone-number') {
                mensagem.textContent = "N√∫mero de telefone inv√°lido: " + fullPhoneNumber;
            } else if (error.code === 'auth/too-many-requests') {
                mensagem.textContent = "Muitas tentativas. Por favor, tente novamente mais tarde.";
            }
            // Pode ser necess√°rio resetar o reCAPTCHA aqui em caso de certos erros
            // grecaptcha.reset(window.recaptchaWidgetId);
            mensagem.style.color = "red";
          });
      } catch (error) {
          console.error("Erro ao inicializar reCAPTCHA ou enviar c√≥digo:", error);
          mensagem.textContent = "Falha na verifica√ß√£o reCAPTCHA ou envio de c√≥digo: " + error.message;
          mensagem.style.color = "red";
      }
    }

    window.verificarCodigo = function() {
      const code = document.getElementById("smsCode").value;
      const mensagem = document.getElementById("mensagemSenha"); // Usar para feedback

      if (!window.confirmationResult) {
        alert("Por favor, envie o c√≥digo SMS primeiro.");
        return;
      }
      if (!code || code.length < 6) { // C√≥digos geralmente t√™m 6 d√≠gitos
        alert("Por favor, digite o c√≥digo de verifica√ß√£o de 6 d√≠gitos recebido via SMS.");
        return;
      }

      window.confirmationResult.confirm(code)
        .then((result) => {
          // Usu√°rio logado com sucesso via telefone
          const user = result.user;
          console.log("Usu√°rio verificado com telefone:", user);
          alert("Cadastro/Login com n√∫mero de celular realizado com sucesso!");
          mensagem.textContent = "Verificado com sucesso!";
          mensagem.style.color = "green";
          window.location.href = "lobby.html"; // Redireciona para a p√°gina de lobby/principal
        })
        .catch((error) => {
          console.error("Erro ao verificar c√≥digo SMS:", error);
          if (error.code === 'auth/invalid-verification-code') {
            mensagem.textContent = "C√≥digo de verifica√ß√£o inv√°lido. Tente novamente.";
          } else if (error.code === 'auth/code-expired') {
            mensagem.textContent = "O c√≥digo de verifica√ß√£o expirou. Por favor, solicite um novo c√≥digo.";
          }
          else {
            mensagem.textContent = "Erro ao verificar c√≥digo: " + error.message;
          }
          mensagem.style.color = "red";
        });
    }

    // Adiciona ouvintes de evento quando o DOM estiver pronto
    document.addEventListener("DOMContentLoaded", () => {
      const senhaInput = document.getElementById("senha");
      const senhaConfirmacaoInput = document.getElementById("senhaConfirmacao");

      if (senhaInput) {
        senhaInput.addEventListener("input", window.verificarSenhaNoInput);
      }
      if (senhaConfirmacaoInput) {
        senhaConfirmacaoInput.addEventListener("input", window.verificarConfirmacaoSenha);
      }
      // Inicializa o reCAPTCHA ao carregar a p√°gina se voc√™ planeja us√°-lo imediatamente
      // ou antes da primeira chamada para enviarCodigo.
      // inicializarRecaptcha().catch(err => console.error("Falha ao inicializar reCAPTCHA no DOMContentLoaded", err));
    });

  </script>

</body>
</html>
